import{S}from"./Spinner-005e47d3.js";import{s as N}from"./statusStore-5e731363.js";import{c as g}from"./cartStore-68777b1b.js";import{m as D,a as y,g as p,o as n,c as i,j as k,h as a,i as v,b as s,F as T,r as E,w as F,v as U,e as r,k as M,t as d,n as h,l as q}from"./index-0872f673.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";const j={components:{Spinner:S},data(){return{couponCode:"Welcome",isDiscount:!1,loading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},computed:{...D(g,["cart"])},methods:{...y(g,["getCart"]),...y(N,["pushMessage"]),onSubmit(e,{resetForm:t}){console.log(JSON.stringify(e,null,2))},isphone(e){return e?/^(09)[0-9]{8}$/.test(e)?!0:"請輸入正確的手機號碼":"此電話欄位為必填"},createOrder(e,{resetForm:t}){const _="https://vue3-course-api.hexschool.io/api/aromamystery-api/order",b=this.form;this.$http.post(_,{data:b}).then(o=>{o.data.success&&(console.log(o.data),t(),this.$router.push(`/checkout/${o.data.orderId}`))})},useCoupon(){this.loading=!0;const e="https://vue3-course-api.hexschool.io/api/aromamystery-api/coupon",t={code:this.couponCode};this.$http.post(e,{data:t}).then(_=>{this.loading=!1,_.data.success?(this.isDiscount=!0,this.getCart(),this.pushMessage({style:"success",title:"已套用優惠券",content:"成功套用優惠券"})):this.pushMessage({style:"danger",title:"套用優惠券錯誤",content:"套用優惠券錯誤"})})}},created(){this.getCart()},watch:{cart(e){e.total!==e.final_total?this.isDiscount=!0:this.isDiscount=!1}}},O={class:"container",id:"checkorder"},P={key:0,class:"row g-0 p-3 text-center"},$=q('<ul class="steps row g-0 list-unstyled mb-4"><li class="col-4 active"><small class="ls-3 d-block">STEP1</small><span>確認訂單</span></li><li class="col-4 mx-3"><small class="ls-3 d-block">STEP2</small><span>建立訂單</span></li><li class="col-4"><small class="ls-3 d-block">STEP3</small><span>完成訂單</span></li></ul>',1),R=[$],z={key:1,class:"min-vh-50 d-flex flex-column align-items-center justify-content-center text-secondary"},A=s("p",{class:"fs-5",style:{"letter-spacing":"2px"}},"購物車內沒有商品",-1),I={key:2,class:"row g-0 justify-content-between"},J={class:"col-md-6 col-lg-5 px-3 m-0"},L=s("h2",{class:"fs-4 d-flex mb-5"}," 確認訂單內容 ",-1),W={class:"table table-warm table-borderless align-middle"},G={class:"tbody"},H={width:"80"},K=["src"],Q={class:"text-muted"},X={class:"d-block"},Y={class:"text-end"},Z={class:"input-group mb-4 text-center"},ss={key:0,type:"text",class:"form-control text-center p-2",placeholder:"已套用優惠券",disabled:""},es=["disabled"],ts={key:0,class:"text-primary"},os={class:"fs-4"},ls={key:1},as={class:"fs-7 text-muted"},ns={class:"text-primary"},is={class:"fs-4"},cs={class:"col-md-6 p-5 bg-white min-vh-50"},rs=s("h2",{class:"fs-4 mb-5"},"填寫訂購資訊",-1),ds={class:"list-unstyled"},ms={class:"mb-3"},us=s("label",{for:"email",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" Email ")],-1),ps={class:"mb-3"},hs=s("label",{for:"name",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" 收件人姓名 ")],-1),_s={class:"mb-3"},fs=s("label",{for:"tel",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" 聯絡電話 ")],-1),bs={class:"mb-3"},gs=s("label",{for:"address",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" 收件地址 ")],-1),ys=s("label",{for:"message",class:"form-label"},"備註",-1),ks=["onClick"];function vs(e,t,_,b,o,f){const x=p("router-link"),V=p("Spinner"),m=p("Field"),u=p("ErrorMessage"),C=p("Form");return n(),i("div",O,[e.cart.total?(n(),i("div",P,R)):k("",!0),e.cart.total?(n(),i("div",I,[s("div",J,[L,s("table",W,[s("tbody",G,[(n(!0),i(T,null,E(e.cart.carts,l=>(n(),i("tr",{key:l.id},[s("td",H,[s("img",{class:"table-img",src:l.product.imageUrl,alt:""},null,8,K)]),s("td",Q,[r(d(l.product.title)+" ",1),s("span",X,"數量："+d(l.qty),1)]),s("td",Y,"NT$ "+d(e.$cash(l.product.price)),1)]))),128))])]),s("div",Z,[o.isDiscount?(n(),i("input",ss)):F((n(),i("input",{key:1,type:"text",class:"form-control text-center p-2",placeholder:"輸入優惠碼","onUpdate:modelValue":t[0]||(t[0]=l=>o.couponCode=l)},null,512)),[[U,o.couponCode]]),s("button",{type:"button",class:"btn btn-sm btn-primary px-3 text-white",disabled:o.isDiscount,onClick:t[1]||(t[1]=l=>f.useCoupon())},[r(" 套用優惠券 "),o.loading?(n(),M(V,{key:0})):k("",!0)],8,es)]),o.isDiscount?(n(),i("div",ls,[s("small",as," 總計金額：$NT "+d(e.$cash(e.cart.total)),1),s("p",ns,[r(" 折扣後金額：$NT "),s("span",is,d(e.$cash(e.cart.final_total)),1)])])):(n(),i("p",ts,[r(" 總計金額：$NT "),s("span",os,d(e.$cash(e.cart.total)),1)]))]),s("div",cs,[rs,a(C,{onSubmit:f.createOrder,novalidate:"",class:"needs-validation",id:"order"},{default:v(({errors:l,validate:w})=>[s("ul",ds,[s("li",ms,[us,a(m,{type:"email",name:"信箱",id:"email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":t[2]||(t[2]=c=>o.form.user.email=c),class:h(["form-control",{"is-invalid":l.信箱}]),placeholder:"請輸入 Email"},null,8,["modelValue","class"]),a(u,{name:"信箱",class:"invalid-feedback"})]),s("li",ps,[hs,a(m,{type:"name",id:"name",name:"姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":t[3]||(t[3]=c=>o.form.user.name=c),class:h(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名"},null,8,["modelValue","class"]),a(u,{name:"姓名",class:"invalid-feedback"})]),s("li",_s,[fs,a(m,{type:"tel",id:"tel",name:"電話",rules:f.isphone,modelValue:o.form.user.tel,"onUpdate:modelValue":t[4]||(t[4]=c=>o.form.user.tel=c),class:h(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入手機號碼",inputmode:"tel"},null,8,["rules","modelValue","class"]),a(u,{name:"電話",class:"invalid-feedback"})]),s("li",bs,[gs,a(m,{type:"text",id:"address",name:"地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":t[5]||(t[5]=c=>o.form.user.address=c),class:h(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址"},null,8,["modelValue","class"]),a(u,{name:"地址",class:"invalid-feedback"})]),s("li",null,[ys,a(m,{as:"textarea",id:"message",name:"備註",type:"text",rules:"",modelValue:o.form.message,"onUpdate:modelValue":t[6]||(t[6]=c=>o.form.message=c),class:h(["form-control",{"is-invalid":l.備註}]),rows:"3"},null,8,["modelValue","class"]),a(u,{name:"備註",class:"invalid-feedback"})])]),s("button",{onClick:w,type:"submit",class:"btn btn-primary w-100 py-3 text-white"},"送出訂單",8,ks)]),_:1},8,["onSubmit"])])])):(n(),i("div",z,[A,a(x,{class:"btn btn-primary py-2 px-4 text-white",to:"/products?category=all&page=1"},{default:v(()=>[r("挑選課程")]),_:1})]))])}const Ns=B(j,[["render",vs]]);export{Ns as default};
