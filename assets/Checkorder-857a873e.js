import{S as E}from"./Spinner-7e8701cb.js";import{s as g}from"./statusStore-01d9db1c.js";import{c as y}from"./cartStore-fc08ca8a.js";import{m as v,a as k,g as d,o as n,c as i,h as a,b as s,j as x,i as V,F as C,r as F,w as U,v as M,e as r,k as L,t as m,n as h,l as q}from"./index-5f5143cc.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";const j={components:{Spinner:E},data(){return{couponCode:"Welcome",isDiscount:!1,loading:!1,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},computed:{...v(y,["cart"]),...v(g,["isLoading"])},methods:{...k(y,["getCart"]),...k(g,["pushMessage"]),onSubmit(e,{resetForm:t}){console.log(JSON.stringify(e,null,2))},isphone(e){return e?/^(09)[0-9]{8}$/.test(e)?!0:"請輸入正確的手機號碼":"此電話欄位為必填"},createOrder(e,{resetForm:t}){const _="https://vue3-course-api.hexschool.io/api/aromamystery-api/order",b=this.form;this.$http.post(_,{data:b}).then(o=>{o.data.success&&(this.getCart(),t(),this.$router.push(`/checkout/${o.data.orderId}`))})},useCoupon(){this.loading=!0;const e="https://vue3-course-api.hexschool.io/api/aromamystery-api/coupon",t={code:this.couponCode};this.$http.post(e,{data:t}).then(_=>{this.loading=!1,_.data.success?(this.isDiscount=!0,this.getCart(),this.pushMessage({style:"success",title:"已套用優惠券",content:"成功套用優惠券"})):this.pushMessage({style:"danger",title:"套用優惠券錯誤",content:"套用優惠券錯誤"})})}},created(){this.getCart()},watch:{cart(e){e.total!==e.final_total?this.isDiscount=!0:this.isDiscount=!1}}},O={class:"container",id:"checkorder"},P={key:0,class:"row g-0 p-3 text-center"},$=q('<ul class="steps row g-0 list-unstyled mb-4"><li class="col-4 active"><small class="ls-3 d-block">STEP1</small><span>確認訂單</span></li><li class="col-4 mx-3"><small class="ls-3 d-block">STEP2</small><span>建立訂單</span></li><li class="col-4"><small class="ls-3 d-block">STEP3</small><span>完成訂單</span></li></ul>',1),R=[$],z={key:1,class:"min-vh-50 d-flex flex-column align-items-center justify-content-center text-secondary"},A=s("p",{class:"fs-5",style:{"letter-spacing":"2px"}},"購物車內沒有商品",-1),I={key:2,class:"row g-0 justify-content-between"},J={class:"col-md-6 col-lg-5 px-3 m-0"},W=s("h2",{class:"fs-4 d-flex mb-5"}," 確認訂單內容 ",-1),G={class:"table table-warm table-borderless align-middle"},H={class:"tbody"},K={width:"80"},Q=["src"],X={class:"text-muted"},Y={class:"d-block"},Z={class:"text-end"},ss={class:"input-group mb-4 text-center"},es={key:0,type:"text",class:"form-control text-center p-2",placeholder:"已套用優惠券",disabled:""},ts=["disabled"],os={key:0,class:"text-primary"},ls={class:"fs-4"},as={key:1},ns={class:"fs-7 text-muted"},is={class:"text-primary"},cs={class:"fs-4"},rs={class:"col-md-6 p-5 bg-white min-vh-50"},ds=s("h2",{class:"fs-4 mb-5"},"填寫訂購資訊",-1),ms={class:"list-unstyled"},us={class:"mb-3"},ps=s("label",{for:"email",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" Email ")],-1),hs={class:"mb-3"},_s=s("label",{for:"name",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" 收件人姓名 ")],-1),fs={class:"mb-3"},bs=s("label",{for:"tel",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" 聯絡電話 ")],-1),gs={class:"mb-3"},ys=s("label",{for:"address",class:"form-label"},[s("span",{class:"text-danger"},"*"),r(" 收件地址 ")],-1),vs=s("label",{for:"message",class:"form-label"},"備註",-1),ks=["onClick"];function xs(e,t,_,b,o,f){const w=d("Loading"),S=d("router-link"),N=d("Spinner"),u=d("Field"),p=d("ErrorMessage"),D=d("Form");return n(),i(C,null,[a(w,{active:e.isLoading},null,8,["active"]),s("div",O,[e.cart.total?(n(),i("div",P,R)):x("",!0),e.cart.total?(n(),i("div",I,[s("div",J,[W,s("table",G,[s("tbody",H,[(n(!0),i(C,null,F(e.cart.carts,l=>(n(),i("tr",{key:l.id},[s("td",K,[s("img",{class:"table-img",src:l.product.imageUrl,alt:""},null,8,Q)]),s("td",X,[r(m(l.product.title)+" ",1),s("span",Y,"數量："+m(l.qty),1)]),s("td",Z,"NT$ "+m(e.$cash(l.product.price)),1)]))),128))])]),s("div",ss,[o.isDiscount?(n(),i("input",es)):U((n(),i("input",{key:1,type:"text",class:"form-control text-center p-2",placeholder:"輸入優惠碼","onUpdate:modelValue":t[0]||(t[0]=l=>o.couponCode=l)},null,512)),[[M,o.couponCode]]),s("button",{type:"button",class:"btn btn-sm btn-primary px-3 text-white",disabled:o.isDiscount,onClick:t[1]||(t[1]=l=>f.useCoupon())},[r(" 套用優惠券 "),o.loading?(n(),L(N,{key:0})):x("",!0)],8,ts)]),o.isDiscount?(n(),i("div",as,[s("small",ns," 總計金額：$NT "+m(e.$cash(e.cart.total)),1),s("p",is,[r(" 折扣後金額：$NT "),s("span",cs,m(e.$cash(e.cart.final_total)),1)])])):(n(),i("p",os,[r(" 總計金額：$NT "),s("span",ls,m(e.$cash(e.cart.total)),1)]))]),s("div",rs,[ds,a(D,{onSubmit:f.createOrder,novalidate:"",class:"needs-validation",id:"order"},{default:V(({errors:l,validate:T})=>[s("ul",ms,[s("li",us,[ps,a(u,{type:"email",name:"信箱",id:"email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":t[2]||(t[2]=c=>o.form.user.email=c),class:h(["form-control",{"is-invalid":l.信箱}]),placeholder:"請輸入 Email"},null,8,["modelValue","class"]),a(p,{name:"信箱",class:"invalid-feedback"})]),s("li",hs,[_s,a(u,{type:"name",id:"name",name:"姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":t[3]||(t[3]=c=>o.form.user.name=c),class:h(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名"},null,8,["modelValue","class"]),a(p,{name:"姓名",class:"invalid-feedback"})]),s("li",fs,[bs,a(u,{type:"tel",id:"tel",name:"電話",rules:f.isphone,modelValue:o.form.user.tel,"onUpdate:modelValue":t[4]||(t[4]=c=>o.form.user.tel=c),class:h(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入手機號碼",inputmode:"tel"},null,8,["rules","modelValue","class"]),a(p,{name:"電話",class:"invalid-feedback"})]),s("li",gs,[ys,a(u,{type:"text",id:"address",name:"地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":t[5]||(t[5]=c=>o.form.user.address=c),class:h(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址"},null,8,["modelValue","class"]),a(p,{name:"地址",class:"invalid-feedback"})]),s("li",null,[vs,a(u,{as:"textarea",id:"message",name:"備註",type:"text",rules:"",modelValue:o.form.message,"onUpdate:modelValue":t[6]||(t[6]=c=>o.form.message=c),class:h(["form-control",{"is-invalid":l.備註}]),rows:"3"},null,8,["modelValue","class"]),a(p,{name:"備註",class:"invalid-feedback"})])]),s("button",{onClick:T,type:"submit",class:"btn btn-primary w-100 py-3 text-white"},"送出訂單",8,ks)]),_:1},8,["onSubmit"])])])):(n(),i("div",z,[A,a(S,{class:"btn btn-primary py-2 px-4 text-white",to:"/products?category=all&page=1"},{default:V(()=>[r("挑選課程")]),_:1})]))])],64)}const Ds=B(j,[["render",xs]]);export{Ds as default};
